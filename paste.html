<!DOCTYPE html>
<html>
    <meta charset="utf-8"/>
    <title>Purrito Bin</title>
    <!-- TODO: find a better source to pull this library from, DON'T TRUST CLOUDFLARE -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <script type="text/javascript">
     // first we get the needed values from the hash
     // this is still secure cuz nothing is sent to the server
     var hashv = window.location.hash.substr(1).split("_");

     var pasteurl = "https://bsd.ac/" + hashv[0] ;
     var key = CryptoJS.enc.Hex.parse(hashv[1]);
     // default IV doesn't matter much because this is a one time
     // use key that is going to be discarded
     var default_iv = CryptoJS.enc.Hex.parse("00000000000000000000000000000000")

     function makeHttpObject() {
         try {return new XMLHttpRequest();}
         catch (error) {}
         try {return new ActiveXObject("Msxml2.XMLHTTP");}
         catch (error) {}
         try {return new ActiveXObject("Microsoft.XMLHTTP");}
         catch (error) {}

         throw new Error("Could not create HTTP request object.");
     }

     // this part is async, so we need to define the decryption calls
     // after the request has been fullfilled
     // the joys of asyn, damn
     var request = makeHttpObject();
     request.open("GET", pasteurl, true);
     request.send(null);
     request.onreadystatechange = function() {
         if (request.readyState == 4){
             decrypted = CryptoJS.AES.decrypt(request.responseText, key, { iv: default_iv, mode: CryptoJS.mode.CBC });
             decoded = decrypted.toString(CryptoJS.enc.Utf8);

             data_div = document.getElementById("dec");
             data_div.innerHTML = decoded;
             return;
         }
     };
    </script>
    <body>
        <pre id="dec"></pre>
    </body>
</html>
